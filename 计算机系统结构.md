# <span id = "index">目录</span>



[TOC]

返回[目录](#index)

# **第一章：计算机系统结构概论**

## 计算机系统多级层次结构

- ![pic](images\image-20191104122437784.png)

- ![pic](images\image-20191104122557577.png)

## 几个术语：机器、虚拟机器、翻译、解释

- **机器**（Machine）：能存储和执行相应语言程序的算法和数据结构的集合体
- **虚拟机器**（Virtual machine）：以软件为主实现的机器称为虚拟机器
- **翻译**（Translation）：先用转换程序将高一级机器上的程序全部变换成低一级机器上可运行的等效程序，然后再在低一级机器上去实现的技术。
- **解释**（Interpretation）：在低一级机器上，用它的一串语句或指令来仿真高一级机器级上的一条语句或指令的功能，通过对高一级机器语言程序中的每条语句或指令逐条解释来实现的技术。

## 多级层次结构划分的好处

1. 有利于正确理解软件、硬件、固件在计算机系统中的地位和作用
2. 推动了计算机系统结构的发展

## Von Neumann型计算机系统结构的特点

- 存储器是按地址访问的顺序编址的一维结构，每个单元的位数是固定的。
- 指令由操作码和地址吗组成。操作数的数据类型由操作码去顶。
- 指令在存储器中按其顺序存储，由程序计数器指明每条指令所在单元的地址。
- 在存储器中，指令与数据同等对待，他们本身无法区别。
- 机器以运算器为中心，I/O设备与存储器的数据传送均经过运算器。所偶操作由控制器进行。
- 信息以二进制编码表示，采用二进制运算。
- 硬件与软件分离，设计单独进行。

## 计算机系统结构（Computer Architecture）

### 定义

   - **经典定义**：计算机系统结构是指程序员所看到的计算机的属性，即概念性结构与功能特性
   - **定义**：计算机系统结构是对计算机系统中各机器级之间 的界面的划分和定义，以及对各级界面上、下的 功能进行分配。
   - **特定含义**：多级层次结构中传统机器级的系统结构，界面之上为软件，界面之下为硬件/固件。

### 透明性

   本来存在的事物火属性，从某个角度看却好像不存在一样，我们称之为透明性

### 研究内容

   软、硬件之间的功能分配以及对传统机器级界面的确定

### 计算机系统结构的属性范围

   - 数据表示
   - 寻址方式
   - 寄存器组织
   - 指令系统
   - 存储系统组织
   - 终端组织
   - 机器状态的定义和切换
   - I/O结构
   - 信息保护

## 计算机组成（Computer Organization）

### 定义

指计算机系统结构的逻辑实现，包括机器级内的数据流和控制流的组成以及逻辑设计等。

### 着眼点

机器级内各事件的排序方法与控制结构、各部件的功能及各部件间的联系。

### 计算机组成设计考虑的主要方面

   - 数据通路宽度
   - 专用部件的设置
   - 部件的共享程度
   - 功能部件的并行度
   - 控制结构的组成方式
   - 缓冲和排队技术
   - 预估、预判技术
   - 可靠性技术

## 计算机实现（Computer Implementation）

### 定义

   指的是计算机组成的物理实现。

### 着眼点

   器件技术和微组装技术。

### 涉及范围

   - 处理机、主存等部件的物理结构
   - 器件的集成度和速度
   - 器件、模块、插件、底板的划分与连接
   - 专用器件的设计
   - 微组装技术
   - 信号传输
   - 电源、冷却及整机装配技术

## 计算机系统结构、组成和实现的相互关系

> 一种计算机系统结构可以有多种计算机组成
>
> 不同计算机系统结构可以使采用的组成技术产生差异
>
> 计算机组成对系统结构的反作用
>
> 一种计算机组成可以有多种计算机实现
>
> 计算机实现对系统结构和组成的反作用
>
> 三者的相互转化

- **程序设计者**看到的计算机系统结构：软硬件功能的分配和确定机器级界面的系统结构
- **计算机设计者**看到的计算机系统结构：着眼于如何最佳最合理地实现分配给硬件的功能的计算机组成
- ![pic](images\image-20191104134441653.png)



## 系统软硬取舍的基本原则

1. 在现有硬件和器件条件下，系统要有更高的性能价格比
2. 采用和拟采用的组成技术不应该过多或不合理地限制各种组成和实现技术的采用
3. 确定软硬件界面时，把为编译和操作系统的实现、高级语言程序的设计、更强的硬件支持发放在首位

- PS：**语义差异**指不同语言之间语义的不同或差异，如高级语言和机器语言之间，不同的高级语言之间等
- ![image](images\image-20191104135534514.png)

## 计算机系统的性能评价

1. 影响计算机系统性能的因素：硬件、软件

2. 计算机性能的分析：峰值性能、持续性能

   - **算术性能平均值**

     ![image](images\image-20191104140154301.png)

     **作用**：衡量速率 衡量时间

   - **调和性能平均值**

     ![image-20191104140311943](images\image-20191104140311943.png)

     **作用**：衡量时间（速度）性能比较准确

   - **几何性能平均值**

     ![image-20191104140408286](images\image-20191104140408286.png)

     **作用**：归一化衡量，大于1的机器性能好，反之亦然

   - **加权方法**

     - 加权算数平均值
     - 加权调和平均值
     - 加权集合平均值

     **作用**：各程序出现的比例不同情况

   - **程序执行时间（Tcpu）的计算**

     前提：忽略CPU以外的系统开销时间

     **Tcpu=IC\*CPI\*1/fc**

     ![image-20191104141136708](images\image-20191104141136708.png)

     IC：程序执行指令总数

     CPI：每条指令的时钟数

     fc：主时钟频率

     n：指令的种类

     Ii：表示第 i 种指令

   - **CPU运行速度的指标**

     - **单位时间执行指令数：MIPS**

     $$
MIPS = \frac{IC}{Tcpu × 10^6} = \frac{fc}{CPI}×10^{-6}
     $$

     ​		适用场合：衡量相同指令系统的计算机性能，标量计算机性能
     
     - **单位时间处理浮点数：MFLOPS**
       $$
       MFLOPS=\frac{I_{FN}}{T_{cpu}}×10^{-6}
       $$
     
       $$
       I_{FN} 是程序运行中浮点运算总次数
       $$
     
       适用场合：衡量计算机的向量处理性能，比较不同向量计算机的向量处理能力
     
       影响因素：程序中浮点运算与定点运算的比例
     
     - $$
       1~MFLOPS\approx3~MIPS
       $$

3. 基准程序（Benchmark）评价方法

   **基准程序**用于测试硬件或软件性能的程序。

   **硬件基准程序**利用程序来测试设备的性能，例如：CPU 执行指令的速度。

   **软件基准程序**确定程序在执行特定任务（例如重新计算电子表格中的数据）时的效率、准确性或速度。测试每个程序时都使用同样的数据，因此从结果可以比较出运行效果更好的程序以及程序运行效果更好的区域。

   - 实际的应用程序
   - 采用核心程序（小规模程序）
   - 合成测试程序
   - 综合基准测试程序

## 计算机系统的定量设计方法

- Huffman压缩原理

- Amdahl定律

- 程序局部性定律

  程序局部性可分为：**时间局部性**、**空间局部性**

  - 时间局部性：最近未来要用的信息很可能 是现在正在使用的信息(循环程序引起)
  - 空间局部性：最近未来要用的信息很可能 是与现在正在使用的信息在程序 空间上是相邻或相近的(指令的顺序执行, 数据的簇聚性)

## 几种系统设计思路

### 由上向下的设计方法

- 过程：从系统最高层次开始设计，向下进行

- 问题：机器用途单一，机器成为专用计算机

### 由下向上的设计方法  

- 过程：从系统最低层开始设计，向上进行 

- 问题：软硬脱节，对软件缺乏足够的支持

### 由中间开始的设计方法 

- 过程：从中间开始，向两个方向推进

- 起点的选择：软硬件界面

## 软件的可移植性

### 基本定义

- **软件可移植性**：指一台机器的软件不加修改或只需经少量修改 就能运行于另一台机器上。

- **必要性**

  充分利用已有的系统软件和应用软件。

### 实验软件的可移植的基本技术

#### 统一高级语言

目前存在的实际问题

- 用途不同,要求语言具有不同的语法结构和语义结构

- 人们对语言基本结构的认识和看法不同

- 不同厂家的机器使同一种高级语言存在差异

- 习惯势力的影响

#### 采用系列机思想

**系列机**：在一个厂家生产的具有相同系统结构的各档机器构成的系列(Family Machine).

**兼容机**：不同厂家生产的具有同一系统结构计算机被称为兼容机(Compatible Machine).

**系列机的重要意义**：计算机发展史上的一个重要里程碑

**软件兼容**：按照系列机的相同机器属性编制的机器语言程序和编译程序都能不加修改地通用于各档机器，称这种情况下的各档机器是软件兼容的。（Software Compatibility）

**软件兼容的分类**：

- 向上兼容：所谓向上兼容，是指按某档机器编制的软件，不加修改就能运行于比它高档的机器上。
- 向下兼容
- 向前兼容
- 向后兼容：最基本的要求和特征。

#### ==模拟与仿真==

用途：解决系统结构不同机器的软件移植

途径：模拟、仿真

##### **模拟**

**模拟**：用机器语言程序解释实现软件移植的方法称为模拟（Simulation）。

**宿主机（Host Machine）**：进行模拟的机器叫宿主机

**虚拟机（Virtual Machine）**：被模拟的机器叫虚拟机

**模拟程序**：所有为各种模拟所编制的程序.

**模拟对象**：机器语言（指令系统） 存储体系 I/O系统  控制台的操作 操作系统

**缺点**：运行速度显著降低，实时性差

**应用场合**：运行时间短，使用次数少，时间关系上没有约束和限制的软件。

**用模拟方法实现应用软件的移植**：![image-20191104155326764](images\image-20191104155326764.png)

##### **仿真**

**仿真**：用微程序直接解释另一种机器指令系统的方法称为仿真（Emulation）。

**宿主机（Host Machine）**：进行仿真的机器叫宿主机

**目标机（Target Machine）**：被仿真的机器叫目标机

**仿真程序**：为仿真所编写的解释微程序。

**仿真对象**：机器语言（指令系统）、存储体系 I/O系统、控制台的操作

**特点**：速度快，结构差异过大的机器难以仿真。

**为实现仿真而增加的新指令**：装入仿真微程序、写回主存、进入仿真、退出仿真

**用仿真方法实现应用软件的移植**：；![image-20191104155808131](images\image-20191104155808131.png)

##### 模拟与仿真的关系

- 区别：解释的语言不同，模拟用 机器 语言解释，存储在主存，仿真用微程 序解释，存储在控制存储器。
- 过程：建立映像，实施操作
- 实际应用方式：二者结合

## 系统结构中的并行性

### 并行性概念

- 并行性：问题中具有可以同时进行运算或操作的特性。
- 并行性的二重含义：
  - 同时性：两个或多个时间在同一时刻发生
  - 并发性：两个或多个时间在同一时间间隔内发生
- 并行性的等级分类：
  - 执行程序的并行性
    - 指令内部
    - 指令之间
    - 任务或进程之间
    - 作业或程序之间
  - 处理数据的并行性
    - 位串子串
    - 位并字串
    - 位片串字并
    - 全并行
  - 计算机信息加工的并行性
    - 存储器操作并行
    - 处理器操作步骤并行
    - 指令、任务、作业并行

### 并行性开发的途径

- 时间重叠(Time Interleaving) : 引入时间因素,如：流水线
- 资源重复(Resource Replication):引入空间因素,如：并行处理机
- 资源共享(Resource Sharing)由软件控制定期轮流使用同一套资源，如：多道程序（分时系统）

###      并行性的开发和并行处理

- 并行处理的方法和达到的目的：发现和利用并行性
- 并行性的开发和并行处理技术的研究：硬件、软件、 语言、算法、性能评价等方面的研究的综合。

### 多机系统的耦合度

#### 多处理机系统

- 多处理机系统：堕胎处理及组成的单一计算机系统
- 特点：
  - 统一的操作系统
  - 本地存储器
  - 处理及之间的交互
  - 并行程度：作业、任务、指令、数据

#### 多计算机系统

- 多计算机系统：多台独立的计算机组成的系统
- 特点：
  - 逻辑上独立的操作系统
  - 通信通过通道或通信线路
  - 多个作业并行

#### 多机系统的耦合度

- **耦合度**：反映各机器之间的物理连接紧密程度和交叉作用能力的强弱程度
- 最低耦合系统：中间存储介质联系
- 松散耦合系统：通道、通信线路实现互连
- 紧密耦合系统：总线、高速开关

术语：异构、同构、对称、非对称（待补充具体内容）

## 计算机系统的分类

### Flynn分类法

- 指令流(Instruction Stream): 指机器执行的指令序列
- 数据流(Data Stream): 指由指令流调用的数据序列
- 多倍性：指在系统性能瓶颈部件上处于同一执行阶段的指令或数据的最大可能个数.
- 分类：	
  - 单指令流单数据流（SISD）
  - 单指令流多数据流（SIMD）
  - 多指令流单数据流（MISD）
  - 多指令流多数据流（MIMD）

### David J. Kuck提出的分类方法

- 用指令流和执行流(Execution Stream)及其多倍性来描述计算机系统总控制器的结构特征
- 分类：
  - 单指令流单执行流(SISE)——典型的单处理机系统；
  - 单指令流多执行流(SIME)——带多操作部件的处理机；
  - 多指令流单执行流(MISE)——带指令级多道程序的单处理机；
  - 多指令流多执行流(MIME)——典型的多处理机系统

### 冯泽云提出的分类方法

- 用数据处理的并行度来定量地描述各种计算机系统特性的冯氏分类法
  - 字串位串(WSBS)——位串处理方式，每次只处理一个字中的一位， 如早期的位串行计算机。
  - 字串位并(WSBP)——字(字片)处理方式，每次处理一个字中的n位，如大多数传统的位并行单处理机。
  - 字并位串(WPBS)——位(位片)处理方式，一次处理m个字中的一位， 如某些相联处理机及阵列处理机。
  - 字并位并(WPBP)——全并行处理方式，一次处理m个字，且每个字为n位,如某些相联处理机,大多数阵列处理机及多处理机。



返回[目录](#index)

# **第二章：数据表示、寻址方式与指令系统**

## 数据表示

### 数据表示与数据结构

1. 数据表示

   - 定义：数据表示指的是机器硬件直接识别和引用的 数据类型.数据表示指的是机器硬件直接识别和引用的 数据类型。

   - 数据表示的实质：软硬件界面及其取舍

   - 种类：定点数、浮点数、逻辑数、二—十进制数据表示

   - 变址操作：为向量和阵列数据结构的实现提供直接支持

     - 变址寄存器—存放变址值：+1功能

     - 首地址寄存器

     - 变址加法器

2. 数据结构

   定义：数据的组织形式**,**可分为抽象数据结构和内部存储结构

3. 数据表示与数据结构

   二者关系：数据表示是数据结构的组成元素
   相互影响：数据表示为数据结构提供支持

4. 程序的可再入性

   程序的可再入性指程序可以被多次执行而不改变其基本功能的特性

### 自定义数据表示

种类：代标识符的数据表示和数据描述符

#### 带标志符数据表示

- 高级语言与机器语言的语义差距分析
- 标识符数据表示的引入与建立
  ![image-20191104210818323](images\image-20191104210818323.png)
- PS：透明性：对于高级语言程序透明，由编译程序建立
- 标志符数据表示的优点
  - 简化指令系统和程序设计
  - 简化编译程序
  - 便于实现一致性校验,提供类型安全环境
  - 可由硬件自动完成数据类型的变换
  - 支持数据库系统的实现与数据类型无关的要求
  - 为软件调试和应用程序开发提供了支持
- 采用标志符数据表示可能产生的问题
  - 由于数据字增加了标识符，程序占用主存空间可能增加
  - 采用标志符会降低指令的执行速度


#### 数据描述符

- 数据描述符和标志符的差别在于：

  - 标志符是和每个数据相连的，合存在一个存储单元中，描述单个数据的类型特征

  - 描述符是与数据分开存放，用于描述所要访问的数据是整块的还是单个的，访问该数据块或数据元素索要的地址以及其他信息

- 以B6700为例，其数据描述符和数据的形式分别如下

  ![image-20191104212414070](images\image-20191104212414070.png)

- 好处：比编制方法实现方便，便于越界检查

#### 向量数组数据表示

- 为向量、数组数据结构的实现和快速运算提供更好的硬件支持的方法是增设向量、数组数据表示
- 在没有向量、数组数据表示的机器上经编译后与借助于变址操作实现。
- 特点：循环体指令顺序地执行，直到完成计算，速度慢
- 向量指令格式，eg：向量加法指令![image-20191104223336513](images\image-20191104223336513.png)
- 向量编址的参数：向量长度、基地址、起始地址、向量有效长度、位移量
- 优点：
  - 快速形成元素地址，成块元素预取
  - 一条指令可以处理整个向量、数组
  - 可以实现越界检查
  - 高速高效
  - 方便处理稀疏矩阵
  - 编译程序简单

#### 堆栈数据表示

- 堆栈及其：具有堆栈数据表示的及其叫做堆栈机器
- 堆栈的作用：
  - 快速寄存器组成的硬件堆栈
  - 直接进行各种运算和处理
  - 访问方式灵活
  - 高级语言的编译(如逆波兰表达式存储）
  - 子程序的嵌套和递归调用

### 引入数据表示的原则

1. 一维线性存储器的局限性

   - 与多维离散数据结构的差距
   - 名称变量非完全顺序存储

2. 引入数据表示的原则

   - 系统效率是否提高

   - 通用性和利用率是否提高

     结论：根据应用环境确定引入复杂的数据类型

## 寻址方式

### 寻址方式

指令寻找操作数或操作数地址的方式

### 主存、寄存器和堆栈的编址方式

- 统一编址方式：无单独的I/O指令
- 独立编址方式：存储空间大，需要专门的指令

### 寻址方式的三个方向

面对主存、寄存器和堆栈的寻址方式

- 面向寄存器
- 面向堆栈
- 面向主存

### 寻址方式在指令中的指明方式

- 占用操作码
- 不占用操作码

### 程序在主存中的定位

 ==逻辑地址与主存物理地址==

#### 概念

- 逻辑地址：（汇编）程序员编写程序时使用的地址
- 主存物理地址：程序在主存中的实际地址
- 逻辑地址空间：由全部逻辑地址构成
- 物理地址空间：全部主存实地址构成
- 名称空间：汇编源程序等使用的符号、标号的名称总称
- 程序的可再入性：程序的可再入性指程序可以被多次执行而不改变其基本功能的特性

#### 逻辑地址空间到主存物理地址空间的转换

- **转换**：直接寻址、间接寻址、变址寻址

- **不转换**：立即寻址（直接操作数），相对寻址

- 程序再定位技术

  - **静态再定位**
    - 定义：程序在执行过程中物理地址不发生变化的定位技术
    - 实现：由==软件==在程序运行前把逻辑地址变换成物理地址
    - 问题：破坏程序可再入性、与指令不可修改规则相违背
  - **动态再定位**
    - 定义：在执行每条指令时才形成访存物理地址的方法叫做动态再定位
    - 实现：通过基址寻址方式进行（==硬件==实现）
      1. 地址加界方法的实现与作用
      2. 程序基点的确定：0为绩点
      3. 基址方法和编制方法的比较

- 物理主存中信息的存储分布

  eg：IBM370的信息及分布情况

  - 信息宽度：字节、半字、单字、双字

  - 主存宽度：64位（b）

  - 一个存储周期访问任意信息的基本要求：

    ==信息宽度小于等于主存宽度==

  - 按整数边界存储的概念

    字节信息地址为  X…XXXX
	  半字信息地址为  X…XXX0
	  单字信息地址为  X…XX00
	  双字信息地址为  X…X000

## 指令系统的设计与优化

### 指令系统设计的基本原则

1. 指令系统的重要性
2. 指令系统设计的问题
   - 指令功能：操作类型/寻址方式/具体操作
   - 指令格式：指令操作码/地址码
3. 新指令系统设计步骤
   - 初拟指令分类与具体指令
   - 编写各种高级语言程序的编译系统
   - 模拟测试
   - 增加复合指令，取代部分指令串
4. 指令的分类（从使用权限角度）
   - 非特权指令：应用程序员使用系统程序员可用
   - 特权指令：系统程序员使用
5. 设计者对指令系统的要求
   - 编译程序设计者对指令系统的要求
     - 规整性
     - 对称性
     - 独立性与全能性
     - 正交性
     - 可组合性
     - 可扩充性
   - 系统结构设计者对指令系统的要求
     - 指令码密度适中
     - 兼容性
     - 适应性
   - **总结**：==指令系统的设计要协调和兼顾编译程序设计者和系统结构设计者的要求==

### 指令操作码的优化

1. 几个术语

   > **指令格式的优化**：用最短的位数来表示指令的操作信息和地址信息。
   >
   > **指令的组成**：操作码和地址吗两部分
   >
   > **Huffman压缩原理**：当各种事件发生的概率不均等时，采用的优化技术对发生概率最高的事件用最少的时间来处理，对发生概率较低的事件用较多的时间来处理，就会导致平均处理时间的缩短。  
   >
   > **Huffman压缩概念(二进制码优化情况）**：
   >
   > 当各种事件发生的概率不均等时，采用的优化技术对发生概率最高的事件用最短位数来表示，对发生概率较低的事件用较长的位数来表示，就会导致表示的平均位数的缩短。

2. 重要公式

   >**信息源熵**：信息员所包含的平均信息量
   >$$
   >H=\sum{p_ilog_2{p_i}}
   >$$
   >**平均编码长度**：
   >$$
   >平均编码长度=\sum{P_iI_i}
   >$$
   >**信息冗余量**：
   >$$
   >信息冗余量=\frac{实际平均码长-H}{实际平均码长}
   >$$

3. Huffman编码方法

   特点：最优化；编码平均长度唯一（编码位数不变）；编码不唯一（0与1可互换）

4. 拓展操作码法

### 指令字格式的要优化的问题

- 任意长度指令字在主存中的存储状况
- 等长单地址码的问题
- 定长指令多地址制格式
- 固定长度的多地址
- 同一地址制下的多种形式和长度

### 指令字格式的优化的措施

- 采用扩展操作吗
- 多种寻址方式
- 多地址制
- 多地址形式
- 整数边界存储原理下，采取多指令长度

## 复杂指令系统计算机与精简指令系统计算机

- 复杂指令系统计算机（Complex Instruction Set Computer，CISC）
- 精简指令系统计算机（Reduced Instruction Set Computer，RISC）